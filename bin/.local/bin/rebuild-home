#!/bin/sh

NIXPKGS="$(nix-build --expr "with import <nixpkgs> {}; callPackage ${HOME}/.config/nixpkgs/home/lib/nixpkgs.nix {}" --no-out-link)"
HOME_MANAGER="$(nix-build --expr "with import <nixpkgs> {}; callPackage ${HOME}/.config/nixpkgs/home/lib/home-manager.nix {}" --no-out-link -I "nixpkgs=${NIXPKGS}")"

"$(nix-build '<nixpkgs>' -A home.home-manager --no-out-link -I nixpkgs="${NIXPKGS}" -I home-manager="${HOME_MANAGER}")/bin/home-manager" \
  -v \
  -f "${HOME}/.config/nixpkgs/home.nix" \
  -I "nixpkgs=${NIXPKGS}" \
  -I "home-manager=${HOME_MANAGER}" \
  switch

# Local Variables:
# mode: shell-script
# End:
